{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://raw.githubusercontent.com/meteor-digital/github-actions/main/schemas/deployment-config.schema.json",
  "title": "Deployment Configuration Schema",
  "description": "Schema for deployment configuration file (deployment-config.yml) used by generic CI/CD workflows",
  "type": "object",
  "required": ["environments", "hosting"],
  "properties": {
    "environments": {
      "type": "object",
      "description": "Environment-specific deployment configuration",
      "patternProperties": {
        "^[a-zA-Z][a-zA-Z0-9-_]*$": {
          "$ref": "#/definitions/environment"
        }
      },
      "additionalProperties": false,
      "minProperties": 1
    },
    "hosting": {
      "type": "object",
      "description": "Hosting provider configuration",
      "required": ["provider"],
      "properties": {
        "provider": {
          "type": "string",
          "description": "Hosting provider type",
          "enum": ["level27", "byte", "hipex", "hostedpower", "generic"]
        },
        "ssh_port": {
          "type": "integer",
          "description": "SSH port for deployment connections",
          "minimum": 1,
          "maximum": 65535,
          "default": 22
        },
        "php_service": {
          "type": "string",
          "description": "PHP service name for restart commands",
          "default": "php-fpm",
          "examples": ["php8.1-fpm", "php-fpm", "php81-fpm"]
        },
        "messenger_worker_id": {
          "type": "string",
          "description": "Messenger worker ID for Shopware/Symfony projects (Level27 specific)",
          "examples": ["1", "worker-1"]
        },
        "custom_commands": {
          "type": "object",
          "description": "Custom commands for generic hosting provider",
          "properties": {
            "restart_services": {
              "type": "string",
              "description": "Command to restart web services",
              "examples": ["sudo service nginx reload && sudo service php-fpm restart"]
            },
            "restart_php": {
              "type": "string",
              "description": "Command to restart PHP service",
              "examples": ["sudo service php-fpm restart"]
            },
            "restart_webserver": {
              "type": "string",
              "description": "Command to restart web server",
              "examples": ["sudo service nginx reload"]
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "deployment": {
      "type": "object",
      "description": "Deployment process configuration (framework-specific defaults are automatically applied)",
      "properties": {
        "shared_folders": {
          "type": "array",
          "description": "Folders to be shared between releases (framework-specific defaults are automatically included)",
          "items": {
            "type": "string"
          },
          "examples": [
            ["files", "public/media", "config/jwt", "var/log"],
            ["storage", "bootstrap/cache"],
            ["var", "public/uploads"]
          ]
        },
        "commands": {
          "type": "object",
          "description": "Custom deployment commands (framework-specific defaults are automatically included)",
          "properties": {
            "pre_deploy": {
              "type": "array",
              "description": "Commands to run before atomic deployment switch",
              "items": {
                "type": "string"
              },
              "examples": [
                ["bin/console database:migrate --all", "bin/console plugin:refresh"],
                ["php artisan migrate --force"],
                ["bin/console doctrine:migrations:migrate --no-interaction"]
              ]
            },
            "post_deploy": {
              "type": "array",
              "description": "Commands to run after atomic deployment switch",
              "items": {
                "type": "string"
              },
              "examples": [
                ["bin/console cache:warmup", "bin/console theme:compile --active-only"],
                ["php artisan config:cache", "php artisan route:cache"],
                ["bin/console cache:warmup --env=prod"]
              ]
            }
          },
          "additionalProperties": false
        },
        "cleanup": {
          "type": "object",
          "description": "Release cleanup configuration",
          "properties": {
            "keep_releases": {
              "type": "integer",
              "description": "Number of releases to keep for rollback capability",
              "minimum": 1,
              "maximum": 10,
              "default": 3
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    }
  },
  "definitions": {
    "environment": {
      "type": "object",
      "description": "Single environment configuration",
      "required": ["host", "path"],
      "properties": {
        "host": {
          "type": "string",
          "description": "Hostname or IP address for deployment",
          "examples": ["prod.example.com", "192.168.1.100"]
        },
        "path": {
          "type": "string",
          "description": "Deployment path on the target host",
          "examples": ["/var/www/prod", "/home/user/app"]
        },
        "maintenance_mode": {
          "type": "boolean",
          "description": "Whether to enable maintenance mode during deployment",
          "default": true
        },
        "database_url": {
          "type": "string",
          "description": "Database connection URL (optional, can use environment variables)",
          "examples": ["${DATABASE_URL}", "mysql://user:pass@host:3306/db"]
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}