name: PR Checks

on:
  workflow_call:
    inputs:
      config_path:
        description: 'Path to pipeline configuration file'
        type: string
        default: '.github/pipeline-config.yml'
    secrets:
      composer_auth:
        description: 'Composer authentication JSON'
        required: true

# Prevent multiple PR checks from running simultaneously for the same PR
concurrency:
  group: pr-checks-${{ github.event.pull_request.number || github.ref }}
  cancel-in-progress: true

jobs:
  validate-config:
    name: 'Validate configuration'
    runs-on: ubuntu-latest
    steps:
      - name: Validate configuration files
        uses: meteor-digital/github-actions/.github/actions/validate-config@main
        with:
          config_directory: '.github'
          fail_on_missing: false  # Don't fail on missing files in PR checks
          validate_schemas: true
          check_changed_only: true  # Only validate changed files in PR context

  quality-checks:
    name: 'Quality checks'
    uses: meteor-digital/github-actions/.github/workflows/quality-checks.yml@main
    with:
      config_path: ${{ inputs.config_path }}
      check_changed_files_only: true
      run_slow_testsuites: false
    secrets:
      composer_auth: ${{ secrets.composer_auth }}