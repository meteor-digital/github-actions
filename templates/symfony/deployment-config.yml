# Deployment Configuration for Symfony Projects
# Schema: https://raw.githubusercontent.com/meteor-digital/github-actions/main/schemas/deployment-config.schema.json
# Framework-specific defaults are automatically applied (shared folders, commands, etc.)

environments:
  test:
    host: "test.example.com"  # Replace with actual hostname
    path: "/var/www/test"  # Replace with actual path
    maintenance_mode: true
    
  staging:
    host: "staging.example.com"  # Replace with actual hostname
    path: "/var/www/staging"  # Replace with actual path
    maintenance_mode: true
    
  prod:
    host: "prod.example.com"  # Replace with actual hostname
    path: "/var/www/prod"  # Replace with actual path
    maintenance_mode: true

hosting:
  provider: "{{HOSTING_PROVIDER}}"  # level27, byte, hipex, hostedpower, generic
  ssh_port: 22
  php_service: "php8.1-fpm"
  messenger_worker_id: "1"  # For Symfony messenger workers (Level27 specific)

# Optional: Override framework defaults
# Symfony defaults include:
# - shared_folders: ["var", "public/uploads"]
# - post_deploy: ["bin/console cache:warmup --env=prod"]
deployment:
  # Add custom shared folders to framework defaults
  shared_folders:
    - "public/media"  # Custom media directory
  
  commands:
    pre_deploy:
      - "bin/console doctrine:migrations:migrate --no-interaction"  # Run database migrations
      - "bin/console messenger:setup-transports"  # Setup message queues
    post_deploy:
      - "bin/console cache:pool:clear cache.global_clearer"  # Clear specific cache pools
      - "bin/console assets:install --symlink --relative"    # Install assets
  
  cleanup:
    keep_releases: 3  # Keep 3 releases for rollback capability
  messenger_worker_id: "1"  # For Symfony projects with Level27

# Optional: Override framework defaults
# deployment:
#   shared_folders:
#     - "var"
#     - "public/uploads"
#     - "custom/shared/folder"  # Add custom folders to defaults
#   
#   commands:
#     pre_deploy:
#       - "custom-pre-deploy-command"  # Add custom commands
#     post_deploy:
#       - "bin/console cache:warmup --env=prod"
#       - "custom-post-deploy-command"  # Add custom commands
#   
#   cleanup:
#     keep_releases: 5  # Override default of 3