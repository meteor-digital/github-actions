# Example deploy workflow for Shopware projects
# This file demonstrates how to reference the reusable deploy workflow

name: Deploy

on:
  workflow_run:
    workflows: ["Build Artifact"]
    types: [completed]
    branches: 
      - 'test/*'
      - 'release/[0-9]+.[0-9]+.[0-9]+'
  workflow_dispatch:
    inputs:
      environment:
        description: 'Environment to deploy to'
        required: true
        type: choice
        options:
          - test
          - acc
          - prod
      version:
        description: 'Version to deploy (leave empty for latest)'
        required: false
        type: string

jobs:
  run:
    uses: meteor-digital/github-actions/.github/workflows/deploy.yml@main
    with:
      config_path: ".github/pipeline-config.yml"
      manual_environment: ${{ github.event.inputs.environment }}
      manual_version: ${{ github.event.inputs.version }}
      workflow_run_id: ${{ github.event.workflow_run.id }}
      workflow_run_branch: ${{ github.event.workflow_run.head_branch }}
      workflow_run_conclusion: ${{ github.event.workflow_run.conclusion }}
      event_name: ${{ github.event_name }}
    secrets:
      ssh_private_key: ${{ secrets.SSH_PRIVATE_KEY }}