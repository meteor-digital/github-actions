# Example build workflow for Shopware projects
# This file demonstrates how to reference the reusable build workflow

name: Build Artifact

on:
  push:
    branches:
      # Build artifacts automatically for test & release branches
      # Exclude release/next from automatic builds
      - 'test/*'
      - 'release/[0-9]+.[0-9]+.[0-9]+'
    tags:
      # Build PROD artifacts when semantic version tags are pushed
      - '[0-9]+.[0-9]+.[0-9]+'
    paths-ignore:
      # Don't build for documentation-only changes
      - '**.md'
      - 'docs/**'
      - '.github/ISSUE_TEMPLATE/**'

concurrency:
  group: build-${{ github.ref }}
  cancel-in-progress: true

jobs:
  build:
    uses: meteor-digital/github-actions/.github/workflows/build-artifact.yml@main
    with:
      config_path: ".github/pipeline-config.yml"
      build_type: "production"
    secrets:
      composer_auth: '{"http-basic":{"satis.meteor.be":{"username":"${{ secrets.METEOR_SATIS_USERNAME }}","password":"${{ secrets.METEOR_SATIS_PASSWORD }}"}},"bearer":{"packages.shopware.com":"${{ secrets.SHOPWARE_STORE_BEARER_TOKEN }}"}}'
      test_env_vars: ${{ secrets.TEST_ENV_VARS }}
