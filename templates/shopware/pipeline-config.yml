# Unified CI/CD Configuration for Shopware Projects
# Schema: https://raw.githubusercontent.com/meteor-digital/github-actions/main/schemas/pipeline-config.schema.json

project:
  name: "my-shopware-shop"  # Used for artifacts, notifications, and releases
  # type: "shopware"  # Auto-detected from shopware-project.yml

runtime:
  php_version: "8.1"  # PHP version for builds and quality checks
  node_version: "18"  # Node.js version for asset compilation
  # php_extensions: "mbstring, intl, gd, xml, zip, curl, opcache, redis, mysql"
  
notifications:
  notification_webhook: "https://cronos.webhook.office.com/webhookb2/3f825001-1c2d-4342-95be-6bcd69e61373@49c3d703-3579-47bf-a888-7c913fbdced9/IncomingWebhook/2bc777eccdcb4609a2ce59e4b169eb86/1260a310-a7bc-49e0-85f0-83993daa24d3/V2nohSwxgbdodaX6_t-2a8COguzwAthQ7QiqzJUb-20_Q1"

quality_checks:
  enabled_tools:
    - "php-cs-fixer"
    - "psalm"
    - "rector"
    - "phpunit"
    - "composer-validate"
    - "phpunuhi"
  
  # Override default binary paths (defaults are vendor/bin/[tool])
  tool_binaries:
    php-cs-fixer: "./vendor/meteor/shop6-project-conventions/tools/php-cs-fixer"
    
  # Optional: Custom quality checks specific to your project
  # custom_checks:
  #   - name: "phpunuhi"
  #     command: "php ./vendor/bin/phpunuhi validate:all"
  #   - name: "security-audit"
  #     command: "composer audit"

build:
  # Files and directories to exclude from build artifacts
  exclude_patterns: |
    *.git*
    node_modules/*
    tests/*
    *.md
    docker-compose*
    devenv*
    .editorconfig
    .envrc
    .vscode
    composer*
    flake*
    symfony.lock
    package*.json
    phpunit.xml*
    psalm*
    rector.php
    .php-cs-fixer.php
    grumphp.yml
    phpunuhi.xml
    bitbucket-pipelines.yml
    shopware-project.yml
    Jenkinsfile*
    patch/*
    scripts/*
  
  # Commands to run during build process
  build_commands: []
    # - "npm run build"
    # - "composer install --no-dev --optimize-autoloader"

  # Build artifact configuration
  artifacts:
    retention_days: 7

deployment:
  environments:
    test:
      host: "test.example.com"  # Replace with actual hostname
      path: "/var/www/test"  # Replace with actual path
      messenger_worker_id: "1"
      
    acc:
      host: "acc.example.com"  # Replace with actual hostname
      path: "/var/www/acc"  # Replace with actual path
      messenger_worker_id: "2"
      
    prod:
      host: "prod.example.com"  # Replace with actual hostname
      path: "/var/www/prod"  # Replace with actual path
      messenger_worker_id: "3"

  hosting:
    provider: "{{HOSTING_PROVIDER}}"  # level27, byte, hipex, hostedpower, generic
    php_service: "php8.1-fpm"

  # Optional: Override framework defaults
  # Shopware defaults are automatically applied:
  # - shared_folders: ["files", "public/media", "public/sitemap", "public/thumbnail", "config/jwt", "var/log"]
  # - pre_deploy: ["bin/console cache:warmup --no-optional-warmers"]
  # - post_deploy: ["bin/console theme:dump", "bin/console theme:compile --active-only", "bin/console scheduled-task:register", "bin/console dal:refresh:index"]
  # - cleanup: keep_releases: 3
  # - Database migrations are handled separately in the deployment workflow

  # Uncomment and customize only if you need to override the defaults:
  # shared_folders:
  #   - "custom/plugins/uploads"  # Add custom shared folders to defaults
  # 
  # commands:
  #   pre_deploy:
  #     - "custom-pre-deploy-command"  # Add custom pre-deploy commands
  #   post_deploy:
  #     - "bin/console theme:dump"
  #     - "bin/console theme:compile --active-only"
  #     - "bin/console database:migrate --all MyProject"
  #     - "custom-post-deploy-command"  # Add custom post-deploy commands
  # 
  # cleanup:
  #   keep_releases: 5  # Override default of 3